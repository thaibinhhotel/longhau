{"ast":null,"code":"import _regeneratorRuntime from\"/Users/bangth/Desktop/TBHotel/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/bangth/Desktop/TBHotel/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _defineProperty from\"/Users/bangth/Desktop/TBHotel/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _classCallCheck from\"/Users/bangth/Desktop/TBHotel/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/bangth/Desktop/TBHotel/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/bangth/Desktop/TBHotel/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/bangth/Desktop/TBHotel/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _assertThisInitialized from\"/Users/bangth/Desktop/TBHotel/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Users/bangth/Desktop/TBHotel/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(source,true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(source).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import React from'react';import ReactDOM from'react-dom';import'./index.css';import{IndexPage}from'./containers/IndexPage';import{LoginPage}from'./containers/LoginPage';import*as serviceWorker from'./serviceWorker';import'bootstrap/dist/css/bootstrap.min.css';import'semantic-ui-css/semantic.min.css';import{Dimmer,Image,Loader,Segment}from'semantic-ui-react';import{ToastContainer}from\"react-toastify\";var ThaiBinhHotel=/*#__PURE__*/function(_React$Component){_inherits(ThaiBinhHotel,_React$Component);function ThaiBinhHotel(props){var _this;_classCallCheck(this,ThaiBinhHotel);_this=_possibleConstructorReturn(this,_getPrototypeOf(ThaiBinhHotel).call(this,props));_this.state={isTokenValid:false,userInfo:{token:sessionStorage.getItem('tokenTBh'),email:sessionStorage.getItem('emailTBh'),ipAddress:\"\"},isChecking:true};['checkTokenValid','getIPAndCheckToken','setTokenValid'].forEach(function(method){return _this[method]=_this[method].bind(_assertThisInitialized(_this));});return _this;}_createClass(ThaiBinhHotel,[{key:\"setTokenValid\",value:function setTokenValid(username,token){// debugger;\nvar userInfo=_objectSpread({},this.state.userInfo);userInfo.email=username;userInfo.token=token;this.setState({isTokenValid:true,userInfo:userInfo});}},{key:\"getIPAndCheckToken\",value:function getIPAndCheckToken(){var _this2=this;this.setState({isChecking:true});fetch(\"https://api.ipify.org/?format=json\",{method:\"GET\",// body: JSON.stringify(data),\nheaders:{\"Content-Type\":\"application/json\"}}).then(function(res){return res.json();}).then(function(result){console.log(result[\"ip\"]);var userInfo=_objectSpread({},_this2.state.userInfo);userInfo['ipAddress']=result[\"ip\"];_this2.setState({userInfo:userInfo});if(!_this2.state.userInfo.token){_this2.setState({isChecking:false});return;}_this2.checkTokenValid(result[\"ip\"]);},function(error){console.log(error);});}},{key:\"checkTokenValid\",value:function(){var _checkTokenValid=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(ipAddress){var _this3=this;var encoded,isValid;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:// let token = sessionStorage.getItem('tokenTBh');\n// let email = sessionStorage.getItem('emailTBh');\n// let ipAddress = this.getIPAddress();\nencoded=\"token=\"+this.state.userInfo.token+\"&email=\"+this.state.userInfo.email+\"&ipAddress=\"+ipAddress;console.log(encoded);isValid=false;fetch('https://script.google.com/macros/s/AKfycby1NCjArXNvliviV9Su8imyfVXsNTUL2memG4bxJhX4JTcyoXGr/exec?func=checkToken',{method:'POST',body:encoded,headers:{\"Content-type\":\"application/x-www-form-urlencoded\"}}).then(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(response){var msgerr;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:msgerr='';_context.next=3;return response.json().then(function(data){console.log(data);data['result']=='error'?msgerr=JSON.stringify(data[\"error\"]):isValid=true;});case 3:case\"end\":return _context.stop();}}},_callee);}));return function(_x2){return _ref.apply(this,arguments);};}()).then(function(){if(isValid){_this3.setState({isTokenValid:true,isChecking:false});}else{_this3.setState({isTokenValid:false,isChecking:false});}});case 4:case\"end\":return _context2.stop();}}},_callee2,this);}));function checkTokenValid(_x){return _checkTokenValid.apply(this,arguments);}return checkTokenValid;}()},{key:\"componentDidMount\",value:function componentDidMount(){// sessionStorage.setItem('tokenTBh', 'fb28ea0172706c801ce7d4e1d4edcb5f');\n// sessionStorage.setItem('emailTBh', 'bang.th@mobivi.vn');\nif(!this.state.userInfo.token){this.setState({isTokenValid:false,isChecking:false});}this.getIPAndCheckToken();}},{key:\"render\",value:function render(){var isTokenValid=this.state.isTokenValid;if(this.state.isChecking){// return <Loader size=\"massive\" active inline='centered'>System is checking your permission...</Loader>\nreturn React.createElement(Segment,null,React.createElement(Dimmer,{active:true,inverted:true},React.createElement(Loader,{size:\"large\"},\"System is checking your permission...\")),React.createElement(Image,{src:\"images/loader.png\"}));}return React.createElement(\"div\",null,React.createElement(ToastContainer,{style:{fontSize:'20px',textAlign:'center'}}),isTokenValid?React.createElement(IndexPage,{userInfo:this.state.userInfo}):React.createElement(LoginPage,{ipAddress:this.state.userInfo.ipAddress,setTokenValid:this.setTokenValid}));}}]);return ThaiBinhHotel;}(React.Component);ReactDOM.render(React.createElement(ThaiBinhHotel,null),document.getElementById('root'));// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\n// serviceWorker.unregister();\nserviceWorker.register();","map":{"version":3,"sources":["/Users/bangth/Desktop/TBHotel/src/index.js"],"names":["React","ReactDOM","IndexPage","LoginPage","serviceWorker","Dimmer","Image","Loader","Segment","ToastContainer","ThaiBinhHotel","props","state","isTokenValid","userInfo","token","sessionStorage","getItem","email","ipAddress","isChecking","forEach","method","bind","username","setState","fetch","headers","then","res","json","result","console","log","checkTokenValid","error","encoded","isValid","body","response","msgerr","data","JSON","stringify","getIPAndCheckToken","fontSize","textAlign","setTokenValid","Component","render","document","getElementById","register"],"mappings":"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","sourcesContent":["import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport {IndexPage} from './containers/IndexPage';\nimport {LoginPage} from './containers/LoginPage';\nimport * as serviceWorker from './serviceWorker';\nimport 'bootstrap/dist/css/bootstrap.min.css';\nimport 'semantic-ui-css/semantic.min.css';\nimport {\n    Dimmer, Image,\n    Loader, Segment\n} from 'semantic-ui-react';\nimport {ToastContainer} from \"react-toastify\";\n\nclass ThaiBinhHotel extends React.Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            isTokenValid: false,\n            userInfo: {\n                token: sessionStorage.getItem('tokenTBh'),\n                email: sessionStorage.getItem('emailTBh'),\n                ipAddress: \"\"\n            },\n            isChecking: true,\n        };\n        [\n            'checkTokenValid',\n            'getIPAndCheckToken',\n            'setTokenValid'\n        ].forEach((method) => this[method] = this[method].bind(this));\n    }\n\n    setTokenValid(username, token) {\n        // debugger;\n        let userInfo = {...this.state.userInfo};\n        userInfo.email = username;\n        userInfo.token = token\n        this.setState({\n            isTokenValid: true,\n            userInfo: userInfo\n        });\n    }\n\n    getIPAndCheckToken() {\n        this.setState({\n            isChecking: true,\n        });\n        fetch(\"https://api.ipify.org/?format=json\", {\n            method: \"GET\",\n            // body: JSON.stringify(data),\n            headers: {\n                \"Content-Type\": \"application/json\"\n            },\n        }).then(res => res.json())\n            .then(\n                (result) => {\n                    console.log(result[\"ip\"]);\n\n                    let userInfo = {...this.state.userInfo};\n                    userInfo['ipAddress'] = result[\"ip\"]\n                    this.setState({\n                        userInfo: userInfo\n                    });\n\n                    if (!this.state.userInfo.token) {\n                        this.setState({\n                            isChecking: false\n                        });\n                        return;\n                    }\n\n                    this.checkTokenValid(result[\"ip\"])\n                }, (error) => {\n                    console.log(error);\n                }\n            )\n    }\n\n    async checkTokenValid(ipAddress) {\n        // let token = sessionStorage.getItem('tokenTBh');\n        // let email = sessionStorage.getItem('emailTBh');\n        // let ipAddress = this.getIPAddress();\n        let encoded = \"token=\" + this.state.userInfo.token +\n            \"&email=\" + this.state.userInfo.email +\n            \"&ipAddress=\" + ipAddress;\n\n        console.log(encoded);\n\n        let isValid = false;\n        fetch('https://script.google.com/macros/s/AKfycby1NCjArXNvliviV9Su8imyfVXsNTUL2memG4bxJhX4JTcyoXGr/exec?func=checkToken', {\n            method: 'POST',\n            body: encoded,\n            headers: {\n                \"Content-type\": \"application/x-www-form-urlencoded\"\n            }\n        }).then(async function (response) {\n            let msgerr = '';\n            await response.json().then(function (data) {\n                console.log(data);\n                data['result'] == 'error' ? msgerr = JSON.stringify(data[\"error\"]) : isValid = true;\n            });\n        }).then(() => {\n            if (isValid) {\n                this.setState({\n                    isTokenValid: true,\n                    isChecking: false\n                });\n            } else {\n                this.setState({\n                    isTokenValid: false,\n                    isChecking: false\n                });\n            }\n        })\n    }\n\n    componentDidMount() {\n        // sessionStorage.setItem('tokenTBh', 'fb28ea0172706c801ce7d4e1d4edcb5f');\n        // sessionStorage.setItem('emailTBh', 'bang.th@mobivi.vn');\n        if (!this.state.userInfo.token) {\n            this.setState({\n                isTokenValid: false,\n                isChecking: false\n            });\n        }\n        this.getIPAndCheckToken();\n    }\n\n    render() {\n        let isTokenValid = this.state.isTokenValid;\n        if (this.state.isChecking) {\n            // return <Loader size=\"massive\" active inline='centered'>System is checking your permission...</Loader>\n            return <Segment>\n                <Dimmer active inverted>\n                    <Loader size='large'>System is checking your permission...</Loader>\n                </Dimmer>\n                <Image src='images/loader.png'/>\n            </Segment>\n        }\n        return (\n            <div>\n                <ToastContainer style={{fontSize: '20px', textAlign: 'center'}}/>\n                {isTokenValid ?\n                    <IndexPage userInfo={this.state.userInfo}/>\n                    :\n                    <LoginPage ipAddress={this.state.userInfo.ipAddress} setTokenValid={this.setTokenValid}/>}\n            </div>\n        )\n    }\n}\n\nReactDOM.render(<ThaiBinhHotel/>, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\n// serviceWorker.unregister();\nserviceWorker.register();\n"]},"metadata":{},"sourceType":"module"}